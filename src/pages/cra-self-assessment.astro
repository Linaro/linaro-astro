---
import BaseLayout from "@/layouts/BaseLayout.astro";
import CraSelfAssessmentComponent from "@/components/forms/CraSelfAssessment.tsx";
import fs from "fs";
import path from "path";
import { Model } from "survey-core";
import { Survey } from "survey-js-ui";
import "survey-core/survey-core.min.css";

// Load the survey JSON from public directory
const surveyJsonPath = path.join(
  process.cwd(),
  "public",
  "cra-self-assessment.json",
);
const surveyJsonContent = fs.readFileSync(surveyJsonPath, "utf-8");
const surveyJson = JSON.parse(surveyJsonContent);
---

<BaseLayout
  title="CRA Self-Assessment"
  description="EU Cyber Resilience Act (CRA) Self-Assessment"
>
  <div
    class="purple-gradient-container absolute h-[50rem] w-full z-[-1] top-[30rem]"
  >
  </div>
  <main class="container mx-auto px-2 sm:px-4 md:px-8 z-0 py-12">
    <h1 class="text-3xl my-12 font-bold">
      EU Cyber Resilience Act (CRA) Self-Assessment
    </h1>
    <p>
      Linaro's CRA self-assessment tool is designed to help companies assess
      their current readiness level for the new regulation.
    </p>
    <p class="mb-8">
      The CRA tool asks a series of questions and helps guide users on where
      gaps may be present and what is required in order to make steps to
      compliance.
    </p>
    <div class="max-w-4xl mx-auto cra-self-assessment-wrapper">
      <CraSelfAssessmentComponent surveyJson={surveyJson} client:load />
    </div>
  </main>
  <style is:global>
    /* Policy error: normal box, Tailwind-based */
    .cra-self-assessment-wrapper .sv-save-data_root.sv-save-data_error,
    .cra-self-assessment-wrapper
      .sv-save-data_root.sv-save-data_error.sv-save-data_root--shown {
      @apply flex items-center gap-3 p-4 mt-4 bg-white text-gray-700 rounded-xl shadow-md text-base font-normal border-0;
      display: flex !important;
    }
    /* Orange icon with white exclamation (Tailwind + custom bg for SVG) */
    .cra-self-assessment-wrapper .sv-save-data_root.sv-save-data_error::before {
      content: "";
      @apply flex-shrink-0 w-7 h-7 min-w-7 min-h-7 rounded bg-orange-500;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23fff'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z'/%3E%3C/svg%3E");
      background-size: 16px;
      background-position: center;
      background-repeat: no-repeat;
    }
    .cra-self-assessment-wrapper .sv-save-data_error .sv-save-data_text,
    .cra-self-assessment-wrapper .sv-save-data_error .sv-save-data_content {
      @apply text-gray-700;
    }
    /* Privacy required error: same look as other required fields (light red background + red message) */
    .cra-self-assessment-wrapper [data-privacy-question].sd-question--error .cra-privacy-agreement {
      background-color: var(--sjs-special-red-light, rgba(230, 10, 62, 0.1));
      border-radius: var(--sjs-corner-radius, 4px);
      padding: 12px;
      margin: 16px 0;
      box-sizing: border-box;
    }
    /* Privacy error message: no background, keep red text only */
    .cra-self-assessment-wrapper .cra-privacy-erbox {
      background: none !important;
      background-color: transparent !important;
    }
  </style>
</BaseLayout>
