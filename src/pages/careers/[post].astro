---
import CareersLayout from "@/layouts/CareersLayout.astro";
import { getCollection, getEntry, type CollectionEntry } from "astro:content";

export const prerender = true;

export async function getStaticPaths() {
  const careers = await getCollection("careers");

  return careers
    .filter((post) => {
      const isPreview = import.meta.env.IS_PREVIEW === "true";
      const isPublished = Date.now() > new Date(post.data.date).getTime();
      return isPreview || isPublished;
    })
    .map((post) => {
      const slug = post.id.replace(/\.mdx?$/, "");
      return {
        params: { post: slug },
        props: { post },
      };
    });
}

const { post: postParam } = Astro.params;
let data: CollectionEntry<"careers"> | undefined = Astro.props.post;

if (!data && postParam) {
  data = await getEntry("careers", postParam);
}

if (!data) {
  return Astro.redirect("/404");
}

const finalPost = data as CollectionEntry<"careers">;
---

<CareersLayout post={finalPost} />