---
import NewsLayout from "@/layouts/NewsLayout.astro";
import { getCollection, type CollectionEntry, getEntry } from "astro:content";
export async function getStaticPaths() {
  const news = await getCollection("news");
  return news
    .filter(
      (post) =>
        String(import.meta.env.IS_PREVIEW) === "true" ||
        Date.now() > new Date(post.data.date).getTime(),
    )
    .map((post) => {
      const slug = post.id ? post.id.replace(/\.mdx?$/, "") : "unknown-post";

      return {
        params: { post: slug },
        props: { post },
      };
    });
}

const { post: postParam } = Astro.params;
let data: CollectionEntry<"news"> | undefined = Astro.props.post;
if (!data && postParam) {
  data = await getEntry("news", postParam);
}

if (!data) {
  return Astro.redirect("/404");
}

const finalPost = data as CollectionEntry<"news">;
---

<NewsLayout post={finalPost} />
