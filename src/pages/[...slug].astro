---
import Flow from "@/layouts/Flow.astro";
import { getCollection, getEntry, render } from "astro:content";

// export const prerender = true;

export const prerender = false;

/*
export async function getStaticPaths() {
  const pages = await getCollection("pages");
  return pages
    .filter((page) => page.id !== "404.md")
    .filter((page) => page.id !== "contact.md")
    .map((page) => {
      const slug =
        page.id === "homepage.md" ? undefined : page.id.replace(/\.mdx?$/, "");

      return {
        params: { slug },
        props: { page },
      };
    });
}
*/

type Props = { page: CollectionEntry<"pages"> };
const { slug } = Astro.params;

/* This logic now runs on the Server Lambda */
let page;
if (!slug) {
  page = await getEntry("pages", "homepage");
} else {
  page = await getEntry("pages", slug);
}

if (!page) {
  return Astro.redirect("/404");
}

const { Content } = await page.render();
---

<Flow frontmatter={page}>
  <Content />
</Flow>
